<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>websocket_Test</title>
    <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
    <meta content="no-cache" http-equiv="pragma">
    <meta content="no-cache" http-equiv="cache-control">
    <meta content="0" http-equiv="expires">
    <meta content="keyword1,keyword2,keyword3" http-equiv="keywords">
    <meta content="This is my page" http-equiv="description">
</head>
<body>
<div>
    <h3>testing...</h3>
    <div id="msgtext">
    </div>
    <div>
        <input id="username" name="username" type="text" placeholder="请输入用户名"/>
        <button onclick="connectWebSocket();">连接WebSocket</button>
        <br>
        <input id="msg" name="msg" type="text" placeholder="请输入发生信息"/>
        <button onclick="sendmsg();">发送</button>
    </div>
</div>

</body>
<script type="text/javascript">
      var ws;
      function connectWebSocket(){
          if('WebSocket' in window){
              var url="ws://localhost:8080/websocket/";
              var username=$('#username').val();
              if(username=="" || username==null){
                alert("请输入用户名");
                return;
              }else{
                url=url+username;
              }
              ws = new WebSocket(url);
          }else{
              alert("不支持 websocket");
          }
          ws.onopen = function(evt){
              //alert("op");
          }
          ws.onclose =function(evt){
              alert("close");
          }
          ws.onmessage = function(evt){
              var msg = evt.data;
              if("[object Blob]" != msg){
                  var msgdiv = document.getElementById("msgtext");
                  var span = document.createElement("span");
                  span.innerHTML = msg+"<br />";
                  msgdiv.appendChild(span);
              }else{
                  var msgdiv = document.getElementById("msgtext");
                  var span = document.createElement("span");
                  var br = document.createElement("br");
                  var can = document.createElement("canvas");
                  var context = can.getContext("2d");
                  var image = new Image();
                    image.onload = function () {
                //image.height
                context.clearRect(0, 0, can.width, can.height);
                context.drawImage(image, 0, 0, can.width, can.height);
            }
            image.src = URL.createObjectURL(msg);
            span.appendChild(can);
            span.appendChild(br);
            msgdiv.appendChild(span);
              }
          }
          ws.onerror = function(evt){
              alert("error");
          }
      }
      function sendmsg(){
          var message={};
          message.content="("+new Date().toLocaleTimeString()+")<br />"+document.getElementById("msg").value;
          message.username=$('#username').val();
          ws.send(JSON.stringify(message));
      }

</script>
</html>